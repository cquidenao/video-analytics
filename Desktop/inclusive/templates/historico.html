<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historial de Métricas</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>Historial de Métricas</h1>
            <div>
                <a href="{{ url_for('index') }}">Volver al Análisis</a>
                <button id="deleteHistoryBtn" class="delete-btn">Borrar Historial</button>
            </div>
        </header>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Nombre del Archivo</th>
                        <th>Fecha de Subida</th>
                        <th>Total de Detecciones</th>
                        <th>Número de Errores</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for file in files %}
                    <tr>
                        <td>{{ file.filename }}</td>
                        <td>{{ file.uploadDate }}</td>
                        <td>{{ file.totalDetections }}</td>
                        <td>{{ file.errorCount }}</td>
                        <td><a href="{{ url_for('analyze_video', file_id=file._id) }}">Ver Análisis</a></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <script>
        document.getElementById('deleteHistoryBtn').addEventListener('click', function() {
            if (confirm("¿Estás seguro de que deseas borrar todo el historial? Esta acción no se puede deshacer.")) {
                fetch('{{ url_for("delete_history") }}', { method: 'POST' })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert("Historial borrado exitosamente.");
                            location.reload();
                        } else {
                            alert("Hubo un error al borrar el historial.");
                        }
                    });
            }
        });
    </script>
</body>
</html>
